---
title: "Reddit /r/Depression Authors who Pen Suicidal Ideation Leave Reddit at Higher Rates"
author: "Lacey Etzkorn"
date: "October 24, 2016"
output: 
      html_document:
            toc: TRUE
---

```{r setup, include=FALSE}
require(ggplot2); require(dplyr); require(reshape2)
options(width = 90)
options(digits = 4)
load("Data/SI_Author_Sample/June_Authors_Combined.RData")
```

Collaborators: Linda Gai

Peer Editors: Guanghao Qi, Matt Cole

Supplemental Materials: [Supplement](Supplement.html).

# Introduction

The problem of suicide plagues social media and online communities devoted to mental health. [add context] 

Social media has also learned to fight back. [add context]

Given the delicate relationship between social media and suicide, it is of utmost importance that community moderators study the impacts of their policies on their community's risk of suicide. There are numerous stories of how seemingly benign changes in community moderation policies have exacerbated user's poor mental health status. For example, [give example].

Currently, moderators do not have data-intensive tools to evaluate the impact of policies on suicide risk. [Do they?]. This is due, in part, to the lack of data available to moderators. In most cases, it is impossible for moderators to observe actual outcomes of suicide, especially when users are anonymous. Surrogate outcomes for suicide are currently in development. For example, Munmun de Choudhury uses [linguistic machine learning methods] to identify and predict user-specific shifts from discussing poor mental health to discussing suicide ideation [CITATION]. However, detecting suicidal ideation in user posts has limited utility when the desired outcome is a rate of suicide.

We propose an alternative parameter, similar in idea to a suicide rate, that community moderators could estimate with available data: the excess expected number of Reddit authors who abandon their accounts (drop out) after expressing suicidal ideation (SI). When we use the term "excess", we refer to the number of dropouts above what we would expect from an equal-sized comparable sample of authors who did not express suicidal ideation. This parameter is only defined for a population of authors who write in a given online community during a given time interval. For example, in this paper we define our population as the set of Reddit authors who post in /r/depression during the month of June 2016. We compare the number of dropouts from the authors who expressed suicidal ideation in June /r/depression (SI-postive authors), to a random sample of authors who did not express suicidal ideation in June /r/depression (SI-negative users). 

Though our method is thoroughly problematic in its current state, we believe that, with a proper amount of statistical development and validation, it has the potential to become a decent measure of suicide rates in online mental health communities.

# Methods

The objective of our project is to estimate the number of suicides for /r/depression authors who post in the month of June 2016. However, this objective is impossible given the available Reddit data. Since we cannot directly quantify the rate of suicide among online mental health boards, we propose an estimable surrogate parameter for a suicide rate: the excess expected number of drop-outs among SI-positive June /r/depression authors. 

The process of collecting the necessary data and estimating this parameter can be broken down into 4 modular steps:

* Collect all posts and comments from /r/depression in June 2016. (See data collection.)

* Classify whether each post or comment contained evidence of SI. Label authors as SI-positive if they had any posts or comments with SI in June 2016 /r/depression. Otherwise they are SI-negative. (See SI Classification.)

* Collect all available post and comment data for every SI-positive authors. Collect all available post and comment data for a similar-sized simple random sample of SI-negative authors. [Code Reference]

* Estimate the number of drop-outs for each the SI-postitive and SI-negative groups. Subtract the latter estimate from the former to get an estimate of the number of excess dropouts among SI-positive authors. (See Estimation of Drop-Out Totals.)

* If a bayesian approach was used, examine the relationship between the estimate and the priors.

### Data Collection

Our target population is Reddit authors who post in the subreddit /r/depression in the month of June. Hence, we scrape all available (as of 4pm October 10, 2016) comment and post data from /r/depression for the month of June using the python package subredditarchive [cite]. The month June was chosen to ensure that we have at least three months of follow-up time for each author. An earlier month wasn't chosen because Reddit censors author comment and post history to the most recent 1,000 items each.

### Estimation of Drop-Out Totals

Our goal is to estimate the number of drop-outs for each SI-positive and SI-negative groups. Ultimately, we will compare our estimated drop-outs between these two groups to determine if there is some association between suicidal ideation and risk of dropping-out. 

First, we estimate the author-specific average time between posts $mu_i$, where $i$ indexes the authors.
We assume that the post histories of each author are a Poisson process, and so observed times between posts are exponentially distributed with mean $mu_i$. For each $\mu_i$, we can specify the prior distribution $1/\mu_i \sim gamma(1,1)$. Hence the posterior for $\mu_i$ is $1/\mu_i|n,\bar{\epsilon} \sim gamma(1 + n, 1 + n\cdot\bar{\epsilon})$, where n is the author's number of intervals between posts, and $\bar{\epsilon}$ is the user-specific average time between posts.

From each $mu_i$, we are able to calculate the probability that the author has stopped using Reddit.
Let $\rho$ be the prior probability that any author drops out of Reddit. Let $t_i$ be the time between data collection and the most recent post for user $i$. This variable can be thought of the "censoring time". Then, the posterior probability that a user quits given their true time between posts is:
$$ p_i|\mu_i   =   \frac{\rho} {e^{-\mu_i\cdot t_i} \cdot (1-\rho) + \rho} $$ 
With this expression, we can transoform the monte-carlo samples from the posterior of $\mu_i$ to monte-carlo samples from the posterior of $p_i$.

Finally, we can calculate the posterior distribution of the expected number of Reddit drop-outs. If $Q_i$ is the indicator that user $i$ has dropped out, then $E(\sum Q_i \Big | p_1, p_2 ...) = E(\sum p_i \Big | p_1, p_2 ...)$.

Using this method, we generate monte-carlo samples from the posterior distribution for the expected number of drop-outs among SI-positive authors and SI-negative authors each. We can then compare these posteriors to get a sense of the number of excess Reddit drop-outs associated with suicidal ideation.

### SI Classification

##### SI Definition

The goal for our classification algorithm is to determine whether comments and posts contain expressions of suicidal ideation (SI). From these classifications, we produce a set of authors that express SI in June /r/Depression. 

The CDC defines suicidal ideation, or thoughts about suicide, as "thoughts of engaging in suicide-related behavior" [cite] and "Thinking about, considering, or planning suicide." [cite]. For our analysis, we change this definition to the following:

We define suicidal ideation (SI) as thinking about, considering, or planning suicide; desire to die; desire to stop living; or engagement in highly dangerous activities or self harm with the implicit goal of ending life. It may include admissions of having suicidal ideation in the past or the potential for suicidal ideation in the future. Evidence of suicidal ideation does not follow from hating or frustration with one's own life, extreme anguish or psychological distress, or engagement in highly dangerous activities or self harm where there is no implicit goal of ending one's life. However, explicit statements about wanting to die or engage in suicide are taken literally.

We change our definition of suicidal ideation to make it clearer what kinds of Reddit comments may constitute SI. For example, the phrase "I don't want to live." does not fall under the CDC SI definition since there is no explicit thoughts of lethal self-harm. Rather, this statement expresses SI through a double-negative. While this definition does not fit a traditional definition of SI, we include these kinds of comments because Reddit moderators may be equally worried about authors who express these comments. 

##### The Algorithm

A number of methods have been implemented to detect suicidal ideation from user-generated text on social media [CITE]. However, for simplicity, we do not use them here.

We expected SI expression to be fairly rare among /r/Depression posts. Thus, in order to get a good estimate of the drop-out risk attributable to SI, we wanted our SI-positive sample to have a minimal proportion of true SI-negative authors. However, we were not worried about true SI-positive authors tainting our SI-negative sample since we expected SI-positive author to be so rare, and hence not have much influence on our estimate of the SI-negative drop-out risk. In other words, we wanted a highly specific algorithm at the sacrifice of sensitivity.

With an intent to achieve this goal, we design an algorithm that searches post text for at least one phrase from an explicit list of SI-expressive phrases that constitute strong evidence of suicidal ideation [Supplement Reference]. 

These phrases were derived from a random sample of 750 June 2016 /r/Depression comments. Human classifiers read through each comment, labeled whether it contained SI expression, and recorded the smallest phrase(s) from that comment that the classifier felt constituted evidence of SI. We then organized the phrases into twelve categories, and noted in brackets where words could be exchangable. For example, [suicide verb] could be replaced with any of the following phrases to still consitute evidence of SI: 

      die, commit suicide, kill myself, off myself, end my life, no longer be here, take some pills, leave this world, end it, blow my brains out, kicked the bucket, kick the bucket, cut my throat, hang myself

# Results

### June /r/Depression

For the month of June, /r/depression contained 22,041 posts, representing contributions from 7,572 authors. We identified 547 SI-positive posts from 492 unique authors. In a simple random sample of 100 SI-positive posts, and 100 SI-positive posts, we estimated the positive predictive value to be 88% (80%, 94%) and the negative predictive value to be 96% (90%, 99%).

### User Follow-Up

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.width=13, fig.height=6}
user.data = 
      author.summary %>%
      group_by(author) %>%
      filter(newest == max(newest)) %>%
      ungroup %>%
      group_by(si.author)%>%
      transmute(author, rank_newest = rank(newest)) %>%
      ungroup %>%
      select(-si.author) %>%
      merge(user.data, by = "author", all.y=T)
user.data$point.label = 
      ifelse(user.data$class, "SI",
      ifelse(user.data$r.depression, "/r/depression","other")) %>%
      ordered(labels = c("Other Subreddit", "/r/Depression", "SI Expressive"))
user.data$si.group = 
      ifelse(user.data$si.author, "SI-Positive in June /r/depression",
             "SI-Negative in June /r/depression")
### Make plot
ggplot(data = subset(user.data, date > jan1)) +
geom_point(aes(y=rank_newest,x=date, 
               color=point.label, alpha=point.label, 
               size=point.label)) + 
ggtitle("Distribution of Post Dates across Authors between Jan. and Oct.") +
ylab("Author Rank by Newest Post") + xlab("Date") +
geom_vline(aes(xintercept = as.numeric(july1)), alpha=0.5) + 
geom_vline(aes(xintercept = as.numeric(june1)), alpha=0.5) + 
scale_colour_manual(name = "Post\nCharacteristics",
                    values = c("grey","darkblue", "red")) + 
scale_size_manual(name = "Post\nCharacteristics",
                  values = c(0.1,0.1,0.3)) + 
scale_alpha_manual(name = "Post\nCharacteristics",
                   values = c(0.1,0.1,1)) + 
theme_bw(20) + 
theme(legend.key = element_blank(),
      legend.position=c(1,0),
      legend.justification = c(1,0),
      legend.background = element_rect(fill=alpha('grey', 0)))+
facet_wrap("si.group") +
guides(color = guide_legend(override.aes = list(size=5, alpha = 1))) 
      
```

**Figure 1: Post histories for SI-Positive authors and SI-Negative authors are different.** Author ids are sorted along the y axis by time of the most recent post. Dates of posts are sorted along the x axis. Each horizontal strip of points represents a user history. Posts are red if they contain SI expression, regardless of their subreddit. Posts without SI expression are blue if they are in the subreddit /r/Depression, or they are otherwise grey. Vertical grey lines outline the month of June, from which data was sampled.

Figure 1 reveals a number of characteristics about the authors in our study. First, we note that those authors who posted more recently tended to post more often, which is expected. Second we see that many authors made multiple SI-positive posts, even among the group that was SI-negative in June /r/depression.

Figure 1 also illuminates a number of important differences between the SI-positive and SI-negative groups. The figure shows that nearly 170 of our 491 authors had their last post in June, which was the period that we used to sample from. In comparison, only about 100 of the SI-negative authors had their last post in June. Fourth, of these 170 authors, many did not post frequently before dropping-off Reddit.

### Drop-Out Rate Estimates

```{r, echo=FALSE, warning=FALSE, fig.height=4, fig.width=5}
load("Data/Posteriors/Attributable_10e-10.Rdata")
ci = quantile(post.excess, probs = c(0.025, 0.975))
```

The histogram below represents the posterior distribution for the rate of drop-outs for authors whose June /r/depression comments were SI-positive.
Our 95% credible interval is (`r ci`). Hence, there is a 95% probability that the expected SI-attributable drop-outs for authors in June 2016 /r/Depression is between `r ci[1]` and `r ci[2]`.

```{r, echo=FALSE, warning=FALSE, message=F,fig.height=4, fig.width=5}
ggplot() +
geom_histogram(aes(x=post.excess),  
               color="black", fill="blue", alpha=0.7) +
ggtitle("Posterior Distribution for\nSI-Attributable Drop-Outs (Prior = 10e-4)")+
xlab("Expected Number of SI-Attributable Drop-Outs") + 
ylab("Count") + 
theme_bw(12)
```

**Figure 2: 10,000 Posterior Monte-Carlo Samples for the Expected Number of SI-Attributable Drop-Outs.**

### Sensitivity to Priors

We found that our conclusions were sensitive to our specified prior probability that any author dropped out. The plot below shows posterior credible intervals for the expected number of SI-attributable drop-outs in June /r/depression.

If we set our prior probability of dropping out equal to 0.5, we would conclude that among the 491 authors who wrote SI-postitive posts in June /r/Depression, there were only about 14 excess reddit drop-outs. However, when we set our prior probability of dropping out below $10^{-5}$, our estimates for excess dropouts associated with SI are in the range of 45 to 55.

```{r, echo=FALSE, warning=FALSE}
load("Data/Posteriors/Attributable_All.Rdata")
load("Data/Posteriors/Priors_All.Rdata")
library(scales)
ggplot() +
geom_errorbar(aes(ymax = post_p[3,], ymin = post_p[1,], x=prior.p)) +
geom_point(aes(y= post_p[2,], x=prior.p)) + 
scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
              labels = trans_format("log10", math_format(10^.x))) + 
theme_bw(16) + 
xlab("Prior Probability of Quitting Reddit") + 
ylab("Expected SI-Attributable Drop-Outs") +
ggtitle("Posterior Credible Intervals for\nTotal SI-Attributable Drop-Outs") 
```

**Figure 3: Posterior credible intervals for SI-attributable drop-outs across many priors.** Each point represents a posterior median for SI-attributable drop outs, while bars represent 2.5% and 97.5% quantiles. Prior probabilities of dropping out range from $\rho = 0.5$ to $\rho=10^{-15.5}$

Given the discrepancy in conclusions we would draw between a large prior and small prior, we reccomend that a small prior be used for the following reason: large prior probabilities of dropping out inflate author-specific posterior probabilities of dropping out with artificial evidence. If instead we use a small prior-probability of dropping out, our posterior estimate that a given author has dropped out relies more heavily on their data: whether the time since an author's most recent post is unusually high compared to their post history. Hence, the estimates of total number of drop-outs among SI-postitive and SI-negative authors respectively is (1) more conservative and (2) requires more data-based evidence. Consequently, the difference in estimated drop-out rates between SI-positive and SI-negative authors is driven more by the data and less by the prior. 

In our previous results, we present a credible interval derived from a prior of $10^-5$ for this reason. The interpretation of this prior is as follows: without seeing any data, we would expect about 0.01 of our approximate 1,000 authors to drop out of reddit. 

# Discussion

Online communities present a unique platform where people can address their own mental health concerns. 

A online community such as the depression subreddit provides a unique opportunity for researchers to glimpse into the thoughts of people with depression outside of a clinical setting. The depression subreddit is a public community where users do not need to present any identifiable information. 

### Future Work

We list a number of extensions and adjustments for this project in order of priority.

First, we need to adjust our estimates to account for the error in our SI classification algorithm. (See [June \r\Depression](#june-/r/depression).) Not knowing whether each author truly expressed SI in their text data should inflate the uncertainty of the estimate.

Second, we need to propose a framework for extending our estimation longitudionally. Community moderators will want to measure SI-attributable drop-outs before and after interventions. However, it is not yet clear how we will measure SI-attributable drop-outs over time, especially when so many authors repeatedly express SI. In this paper, we only estimate the SI-attributable drop-outs for June 2016 authors with data collected at a single time point (October 10, 2016). 

Third, our method does not properly account for counfounding relationships between SI and droping out. For example, moderators ban authors for "trolling." If being banned for trolling is more prevalent among SI-negative (or SI-positive) authors, our estimate of the drop-outs attributable to SI will be biased downward (or upward).

Fourth, we need to better assess the fit of our model to the observed data. We use a parametric Bayesian approach to estimate each author's individual probability of having dropped out. In this framework, we assumed that times between an author's posts follow an exponential distribution. However, mixture of exponential distributions with adjustments for temporal trends may better fit the data. 

Fifth, we ignore the information the author's text may contain about dropping out or attempting suicide. For example, we do not differentiate between suicidal ideation and suicide plans. A body of psychological literature documents the importance of accounting for and quantifying suicidal intent and planning when examining suicide risk [CITE]. However, attempting to mine such psychological measures from a large amount of text data is far beyond the scope of this paper and easily beyond the frontiers of psychological science and machine learning.


# Works Cited

* Discovering Shifts to Suicidal Ideation from Mental Health Content in Social Media (2016) http://www.munmund.net/pubs/chi16_SuicidalIdeation.pdf 

* Social Media as a Measurement Tool of Depression in Populations (2013) http://www.munmund.net/pubs/websci_13.pdf

* Predicting Postpartum Changes in Emotion and Behavior via Social Media (2013) http://www.munmund.net/pubs/chi_13.pdf

* Social Media Embraces Suicide Prevention CMAJ August 11, 2015 vol. 187 no. 11 First published June 29, 2015, doi: 10.1503/cmaj.109-5104 http://www.cmaj.ca/content/187/11/E333.short 

* http://www.cdc.gov/violenceprevention/suicide/definitions.html

* https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2576496/

http://www.cdc.gov/violenceprevention/suicide/definitions.html


